<html>
  <head>
    <title>当下主流 APP , Hybrid app 中需要熟练掌握的交互知识（一） - smartbeng</title>
    <link href='/images/fav.png' rel='shortcut icon'>
<link href='/atom.xml' rel='alternate' type='application/rss+xml'>
<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/responsive.css">
<script src="/js/jquery.js"></script>
<script src="/js/basics.js"></script>
<meta content='width=device-width, initial-scale=1.0, user-scalable=no' name='viewport'>
<meta content='text/html; charset=utf-8' http-equiv='content-type'>


  </head>
  <body>
    <header>
  <a id='go-back-home' href='/'><img src='/images/scribble.png' alt='Home' width='53' height='59'></a>
  <p>smartbeng</p>
  <p>做好今天的自己！</p>
</header>

    <div id='container'>
      <div class='block'>
  
    <a class='main' href='/'>Blog</a>
  
    <a class='main' href='/about/index.html'>About</a>
  
    <a class='main' href='mailto:smartbengs@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/smartbeng'>Github</a>
  
</div>

      <section class='paging'>
  
    <div class='left'>
      <a href='/2017/05/11/hinfo/'>
        ‹
      </a>
    </div>
  
  
    <div class='right'>
      <a href='/2017/04/20/RunTime/'>
        ›
      </a>
    </div>
  
</section>

      <div class='content'>
        <section class='post'>
          <h1>
            <div class='date'>2017-04-28</div>
            当下主流 APP , Hybrid app 中需要熟练掌握的交互知识（一）
          </h1>
          <p>2014年10月29日，<a href="http://baike.baidu.com/item/%E4%B8%87%E7%BB%B4%E7%BD%91%E8%81%94%E7%9B%9F" target="_blank" rel="external">万维网联盟</a>宣布，经过接近8年的艰苦努力，该标准（HTML5）规范终于制定完成。接着，整个移动端开发领域开始了一场翻天覆地的改革变迁，主要「受益」者， ios , Android.</p>
<p>现如今的形势无疑使这个行业的门槛抬的非常高，我们都知道以前会写几个 demo 工作就没问题了，这是移动开发正火热的时期。之后接着有很多同学的自学效率不错，凭着一己之力，培训也算，每年大量新人涌入这个高薪行业！</p>
<p>前两天吃饭的时候 HR 告诉我说，他说两年前招 Android 的时候给出的价格是 15k，而且还招不到，如今 10 都不愿意给了，发一个职位来的人排着队面试 ！可见移动行业的现状的确是跟之前的差距拉的太大。</p>
<p>包括我刚出来的时候基本没有接触过 WebApp 领域的东西，更不会去娴熟的利用 WebView 做着各种交互，以至于找工作就费了很大的力气，如今，Hybrid App 已然是绝对的主流地位！</p>
<h3 id="什么是-Hybrid-App"><a href="#什么是-Hybrid-App" class="headerlink" title="什么是 Hybrid App"></a>什么是 Hybrid App</h3><p>Native App（原生界面）+ WebApp （基于 H5 的 WebView 网页）== Hybrid App（混合型）</p>
<p>那这样一个公式就说的很清楚了，所谓的 Hybrid 就是原生与网页混合开发，有时候原生界面调 H5 页面，有时 H5 网页又来调原生，为什么会衍生出这种开发模式呢？H5 可跨平台，一套页面 ios 和 android 公用，开发成本较低，再者网页不占内存等等，一张图来稍微概括：</p>
<p><img src="https://github.com/smartbeng/smartbeng.github.io/raw/master/img/xxx.png" alt="ggg" title="jjj"></p>
<p>关于三者之间的对比这只是片面的，更多详细的资料大家自行搜索查看！虽然前两者的体验与性能都不会优于后者，但是大势所趋，我们谁也改变不了！</p>
<h3 id="1-使用-WebView-加载网页"><a href="#1-使用-WebView-加载网页" class="headerlink" title="1. 使用 WebView 加载网页"></a>1. 使用 WebView 加载网页</h3><p>这里没什么好说的，直接上代码：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 页面布局 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">WebView</span></span></div><div class="line">    <span class="attr">android:id</span>=<span class="string">"@+id/web"</span></div><div class="line">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent</span></div><div class="line">    android:layout_height="<span class="attr">match_parent</span>" /&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">*第一部分 ：记载显示网页</div><div class="line">*/</div><div class="line">mWebView = (WebView) mMainContainer.findViewById(R.id.wv_container);</div><div class="line"></div><div class="line"><span class="comment">// 设置加载网页的地址</span></div><div class="line">mWebView.loadUrl(<span class="string">"http://www.baidu.com"</span>);</div><div class="line"></div><div class="line">WebSettings settings = mWebView.getSettings();</div><div class="line"></div><div class="line"><span class="comment">// 启用 JavaScript 支持（WebView的设置）</span></div><div class="line">settings.setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line">* new WebViewClient</div><div class="line">* 解决跳转到第三方浏览器</div><div class="line">* 这里面处理行对应的页面逻辑</div><div class="line">*/</div><div class="line">mWebView.setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line"></div><div class="line">  <span class="comment">//处理页面逻辑的方法 详细举例在下一片段</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">  </div><div class="line">    mWebView.loadUrl(url);</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    </div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="comment">// 页面开始加载</span></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">  </div><div class="line">    <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (!mDialog.isShowing())</div><div class="line">    </div><div class="line">      mDialog.show();  <span class="comment">//显示加载进度条</span></div><div class="line">      </div><div class="line">  &#125; </div><div class="line">  </div><div class="line">  <span class="comment">/**</span></div><div class="line">  </div><div class="line">  * 页面加载完成</div><div class="line">  </div><div class="line">  * <span class="doctag">@param</span> view</div><div class="line">  </div><div class="line">  * <span class="doctag">@param</span> url</div><div class="line">  </div><div class="line">  */</div><div class="line">  </div><div class="line">  <span class="meta">@Override</span></div><div class="line">  </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">  </div><div class="line">    <span class="keyword">super</span>.onPageFinished(view, url);</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (mDialog.isShowing())</div><div class="line">    </div><div class="line">      mDialog.dismiss();  <span class="comment">//加载完成 隐藏进度条</span></div><div class="line">      </div><div class="line">  &#125;</div><div class="line">  </div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>我们首先利用 WebView 加载了这个网页，其次给他设置，解决浏览器跳转，显示加载进度条等等！</p>
<p>相信大家都很明白这还只是入门 Demo 的写法，那么在项目中我们是怎么处理这些设置和逻辑呢？</p>
<p>第一 ：实际项目中的 WebView 存在与多个地方</p>
<p>第二 ：原生与 Web 混合型</p>
<p>第三 ： 网页大多数有他后台自己加好的逻辑与功能（包括 js 方法），怎么配合！</p>
<p>第四：你必须要做的 Cookie 处理</p>
<p><strong>那么我们将以这几个问题开始进行分享，所以接下来会开是一个 HyBrid 主题系列的文章，估计会有好几篇！</strong></p>
<h3 id="2-建立-Activity-管理类"><a href="#2-建立-Activity-管理类" class="headerlink" title="2. 建立 Activity 管理类"></a>2. 建立 Activity 管理类</h3><p>这一步是项目开发必备，我们面对这越来越多的页面的时候，如果不管理，你总有无从下手的时候！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Activity 管理类</div><div class="line"> * Created by ShiYunpeng on 2016/12/28.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ActivityCollector</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;Activity&gt; activityList = <span class="keyword">new</span> ArrayList&lt;&gt;();  <span class="comment">//用来管理所有的activity</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 添加当前的Activity到栈中</div><div class="line">     * <span class="doctag">@param</span> activity</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addActivity</span><span class="params">(Activity activity)</span></span>&#123;</div><div class="line">        activityList.add(activity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 将当前Activity移出返回栈</div><div class="line">     * <span class="doctag">@param</span> activity</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeActivity</span><span class="params">(Activity activity)</span></span>&#123;</div><div class="line">        activityList.remove(activity);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取到栈顶的Activity</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Activity <span class="title">getTopActivity</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">if</span> (activityList.isEmpty())&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;<span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> activityList.get(activityList.size() - <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>那么这三个方法解决了我们很多问题，包括由于资源未及时释放以及让你措手不及的 ANR，可别小看他！</p>
<p>以上写法的应用：在 Activity 中我们需要在项目初始化的时，用我们建好的这个类 ActivityClooector.addActivity() 来添加我们的 Activity 到栈中，同样的方法，在 Activity 将要销毁的时候去选择 remove 他，后面我们会在一些重要的类中（非 Activity）去用 getToopActivity() 来获取到我们的栈顶 Activity，非常重要！</p>
<h3 id="3-建立-WebViewController-管理类"><a href="#3-建立-WebViewController-管理类" class="headerlink" title="3. 建立 WebViewController 管理类"></a>3. 建立 WebViewController 管理类</h3><p>那么这一步更加重要了，还记得我们第一小节是怎么设置 WebView 的吗？我们是在加载他的 Activity 中来进行设置的，那么当有多个页面时，又当每个页面加载 WebView 所要的设置数量不同的时候，就比较难处理了！</p>
<p>所以这里只用一个类来将项目中所有关于 WebView 的设置，以及 WebView 单层面的处理都放在这里！</p>
<p><strong>先行列出 WebView 中常用设置以及方法</strong></p>
<ol>
<li><strong>WebSettings</strong></li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">//下面三个最常用，基本都需要设置 </div><div class="line"></div><div class="line">setCacheMode 设置缓存的模式 eg: settings.setCacheMode(WebSettings.LOAD_NO_CACHE); </div><div class="line"></div><div class="line">setJavaSciptEnabled 设置是否支持Javascript eg: settings.setJavaScriptEnabled(true); </div><div class="line"></div><div class="line">setDefaultTextEncodingName 设置在解码时使用的默认编码 eg: settings.setDefaultTextEncodingName(“utf-8”); </div><div class="line"></div><div class="line">setAllowFileAccess 启用或禁止WebView访问文件数据 </div><div class="line"></div><div class="line">setBlockNetworkImage 是否显示网络图像 </div><div class="line"></div><div class="line">setBuiltInZoomControls 设置是否支持缩放 </div><div class="line"></div><div class="line">setDefaultFontSize 设置默认的字体大小 </div><div class="line"></div><div class="line">setFixedFontFamily 设置固定使用的字体 </div><div class="line"></div><div class="line">setLayoutAlgorithm 设置布局方式 </div><div class="line"></div><div class="line">setLightTouchEnabled 设置用鼠标激活被选项 </div><div class="line"></div><div class="line">setSupportZoom 设置是否支持变焦</div></pre></td></tr></table></figure>
<ol>
<li><strong>WebViewClient</strong></li>
</ol>
<p>设置WebViewClient：mWebView.setWebViewClient(new WebViewClient(){</p>
<p>   这里包含以下方法</p>
<p>});</p>
<p>方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">onPageStarted 网页开始加载 </div><div class="line"></div><div class="line">onReceivedError 报告错误信息 </div><div class="line"></div><div class="line">onLoadResource 加载指定地址提供的资源 </div><div class="line"></div><div class="line">shouldOverrideUrlLoading 控制新的连接在当前WebView中打开 </div><div class="line"></div><div class="line">onPageFinished 网页加载完毕，此方法并没有方法名表现的那么美好，调用时机很不确定。如需监听网页加载完成可以使用onProgressChanged，当int progress返回100时表示网页加载完毕。 </div><div class="line"></div><div class="line">doUpdate VisitedHistory 更新历史记录 </div><div class="line"></div><div class="line">onFormResubmission 应用程序重新请求网页数据 </div><div class="line"></div><div class="line">onScaleChanged WebView发生改变</div></pre></td></tr></table></figure>
<ol>
<li><p><strong>WebChromeClient</strong> mWebView.setWebViewClient(new WebChromeClient(){</p>
<p>​    同样例举出常用方法</p>
<p>}); </p>
</li>
</ol>
<p>方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">onProgressChanged 加载进度条改变 </div><div class="line"></div><div class="line">onJsPrompt 用在解决4.2以下addJavascriptInterface漏洞问题 </div><div class="line"></div><div class="line">onCloseWindow 关闭WebView </div><div class="line"></div><div class="line">onCreateWindow 创建WebView </div><div class="line"></div><div class="line">onJsAlert 处理Javascript中的Alert对话框 </div><div class="line"></div><div class="line">onJsConfirm处理Javascript中的Confirm对话框 </div><div class="line"></div><div class="line">onJsPrompt处理Javascript中的Prompt对话框 </div><div class="line"></div><div class="line">onReceivedlcon 网页图标更改 </div><div class="line"></div><div class="line">onReceivedTitle 网页Title更改 </div><div class="line"></div><div class="line">onRequestFocus WebView显示焦点 </div><div class="line"></div><div class="line">onConsoleMessage 在Logcat中输出javascript的日志信息</div></pre></td></tr></table></figure>
<p><strong>下来列举我对于此模块的处理方法</strong></p>
<p>我在这里建立了一个 <strong>WebViewCtroller</strong>类，用于将所有能用到设置以及需要添加的功能都写在里面，据我所知，只是现在普遍流行的一种写法，我们开始看，注释很详细！</p>
<figure class="highlight java"><table><tr><td class="code"><pre><div class="line"><span class="comment">//项目所在包，待会要用</span></div><div class="line"><span class="keyword">package</span> com.lansum.eip.webview;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebViewController</span> <span class="keyword">extends</span> <span class="title">WebView</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//声明上下文对象</span></div><div class="line">    <span class="keyword">private</span> Context context;</div><div class="line"></div><div class="line">    <span class="comment">//声明WebViewController全局对象</span></div><div class="line">    <span class="keyword">private</span> WebViewController control;</div><div class="line"></div><div class="line">    <span class="comment">//网络未加载完的loading图片</span></div><div class="line">    <span class="keyword">private</span> ImageView imageView;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebViewController</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        <span class="keyword">this</span>.context = context;</div><div class="line">        webviewSettings();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebViewController</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</div><div class="line">        webviewSettings();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WebViewController</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        webviewSettings();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/*</span></div><div class="line">     *这个注解的意思就是让本地区识别服务器的接口名字</div><div class="line">     *然后去匹配</div><div class="line">    */</div><div class="line">    <span class="meta">@SuppressLint</span>(<span class="string">"JavascriptInterface"</span>)</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">webviewSettings</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        control = <span class="keyword">this</span>;</div><div class="line"></div><div class="line">        <span class="comment">// TODO Auto-generated constructor stub</span></div><div class="line">        WebSettings webSettings = <span class="keyword">this</span>.getSettings();</div><div class="line">        webSettings.setJavaScriptEnabled(<span class="keyword">true</span>);</div><div class="line">        webSettings.setJavaScriptCanOpenWindowsAutomatically(<span class="keyword">true</span>);</div><div class="line">        webSettings.setSupportZoom(<span class="keyword">false</span>);</div><div class="line">        webSettings.setBuiltInZoomControls(<span class="keyword">false</span>);</div><div class="line">        webSettings.setAllowFileAccess(<span class="keyword">true</span>);</div><div class="line">        webSettings.setAllowContentAccess(<span class="keyword">true</span>);</div><div class="line">        webSettings.setAllowFileAccessFromFileURLs(<span class="keyword">true</span>);</div><div class="line">        webSettings.setAllowUniversalAccessFromFileURLs(<span class="keyword">true</span>);</div><div class="line">        webSettings.setDatabaseEnabled(<span class="keyword">true</span>);</div><div class="line">        webSettings.setDomStorageEnabled(<span class="keyword">true</span>);</div><div class="line">        webSettings.setGeolocationEnabled(<span class="keyword">true</span>);</div><div class="line">        webSettings.setAppCacheEnabled(<span class="keyword">true</span>);</div><div class="line">        webSettings.setAppCachePath(context.getCacheDir().getPath());</div><div class="line">        webSettings.setDefaultTextEncodingName(<span class="string">"gbk"</span>);</div><div class="line">        <span class="comment">// 屏幕自适应</span></div><div class="line">        webSettings.setUseWideViewPort(<span class="keyword">true</span>);</div><div class="line">        webSettings.setLoadWithOverviewMode(<span class="keyword">true</span>);</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            webSettings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            webSettings.setCacheMode(WebSettings.LOAD_DEFAULT);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.HONEYCOMB) &#123;</div><div class="line">            webSettings.setDisplayZoomControls(<span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.KITKAT) &#123;</div><div class="line">            webSettings.setLoadsImagesAutomatically(<span class="keyword">true</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            webSettings.setLoadsImagesAutomatically(<span class="keyword">false</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">/**禁止屏幕自动旋转*/</span></div><div class="line">        <span class="keyword">this</span>.setScrollBarStyle(<span class="keyword">this</span>.SCROLLBARS_INSIDE_OVERLAY);</div><div class="line">        <span class="keyword">this</span>.setHorizontalScrollBarEnabled(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">this</span>.setHorizontalFadingEdgeEnabled(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">this</span>.setVerticalFadingEdgeEnabled(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">        <span class="comment">/*下面的类是一个专门处理网页与本地交互的类</span></div><div class="line">         *这里的意思是先创建这个类的对象</div><div class="line">         *然后经本地所有服务端的接口封装在了这个类对象中</div><div class="line">         *这样在这个类中处理交互的时候就很方便了</div><div class="line">         *这个在后续中详细解释</div><div class="line">         */</div><div class="line">        HtmlMessageForLocal newWebViewActivity = <span class="keyword">new</span> HtmlMessageForLocal();</div><div class="line">        <span class="keyword">this</span>.addJavascriptInterface(newWebViewActivity, <span class="string">"android"</span>);</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 让网页的弹框转化为原生化的弹框</div><div class="line">         * onJsAlert 这个方法名是死的</div><div class="line">         */</div><div class="line">        setWebChromeClient(<span class="keyword">new</span> WebChromeClient() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onJsAlert</span><span class="params">(WebView view, String url, String message, <span class="keyword">final</span> JsResult result)</span> </span>&#123;</div><div class="line">            </div><div class="line">                AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.Builder(context).setTitle(<span class="string">"错误提醒"</span>)</div><div class="line">                <span class="comment">/*注意，这里的 message 是服务端网页传过来的参数</span></div><div class="line">                 *只需要经这个参数设置到弹出框中即可</div><div class="line">                 *这里不同的服务方会有不同需求</div><div class="line">                 */</div><div class="line">                        .setMessage(message)</div><div class="line">                        .setIcon(R.drawable.icon_login)</div><div class="line">                        .setPositiveButton(<span class="string">"好"</span>, <span class="keyword">new</span> AlertDialog.OnClickListener() &#123;</div><div class="line">                            <span class="meta">@Override</span></div><div class="line">                            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(DialogInterface dialog, <span class="keyword">int</span> which)</span> </span>&#123;</div><div class="line">                                result.confirm();</div><div class="line">                            &#125;</div><div class="line">                        &#125;);</div><div class="line">                builder.setCancelable(<span class="keyword">false</span>);</div><div class="line">                builder.create();</div><div class="line">                builder.show();</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        setWebViewClient(<span class="keyword">new</span> WebViewClient() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">shouldOverrideUrlLoading</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">                <span class="comment">// 这些页面添加顶部导航</span></div><div class="line">                <span class="keyword">if</span> (url != <span class="keyword">null</span> &amp;&amp; !url.matches(<span class="string">".*"</span>+ Constants.urlLogIn+<span class="string">".*"</span>)) &#123;</div><div class="line">                    <span class="comment">//指定网页要跳转的目标类</span></div><div class="line">                    Intent intent = <span class="keyword">new</span> Intent(context, NewWebViewActivity.class);</div><div class="line">                    <span class="comment">//将地址传过去</span></div><div class="line">                    intent.putExtra(<span class="string">"url"</span>, url);</div><div class="line">                    <span class="comment">//将动画也传过去</span></div><div class="line">                    intent.putExtra(<span class="string">"animation"</span>,R.anim.slide_right_out);</div><div class="line">                    context.startActivity(intent);</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="comment">/**</span></div><div class="line">            *网络错误时的回调方法</div><div class="line">            */</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceivedError</span><span class="params">(WebView view, <span class="keyword">int</span> errorCode, String description, String failingUrl)</span> </span>&#123;</div><div class="line"></div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line">             * WebView开始加载</div><div class="line">             * <span class="doctag">@param</span> view</div><div class="line">             * <span class="doctag">@param</span> url</div><div class="line">             * <span class="doctag">@param</span> favicon</div><div class="line">             */</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageStarted</span><span class="params">(WebView view, String url, Bitmap favicon)</span> </span>&#123;</div><div class="line">                <span class="comment">// TODO Auto-generated method stub</span></div><div class="line">                <span class="keyword">super</span>.onPageStarted(view, url, favicon);</div><div class="line">              </div><div class="line">                <span class="comment">/**</span></div><div class="line">                 * 动态创建网络加载中的GIf图片</div><div class="line">                 */</div><div class="line">                imageView = <span class="keyword">new</span> ImageView(ActivityCollector.getTopActivity().getApplicationContext());</div><div class="line">                ViewGroup.LayoutParams size = <span class="keyword">new</span> ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, <span class="number">80</span>);</div><div class="line">                imageView.setLayoutParams(size);</div><div class="line">                Glide.with(ActivityCollector.getTopActivity()).load(R.drawable.loading3).into(imageView);</div><div class="line">                ViewGroup parentLayout = (ViewGroup) WebViewController.<span class="keyword">this</span>.getParent();</div><div class="line">                parentLayout.addView(imageView);</div><div class="line">                parentLayout.getPaddingRight();</div><div class="line">                imageView.setVisibility(View.VISIBLE);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">/**</span></div><div class="line">             * WebView加载完成</div><div class="line">             * <span class="doctag">@param</span> view</div><div class="line">             * <span class="doctag">@param</span> url</div><div class="line">             */</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPageFinished</span><span class="params">(WebView view, String url)</span> </span>&#123;</div><div class="line">                <span class="comment">//让加载的GIf动图消失</span></div><div class="line">                imageView.setVisibility(View.GONE);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>其实说起来代码也不多，根据需求来添加即可。注意，这个类世纪城于 WebView 的！</p>
<p>关于如何知道网页服务端给我们传过来的是什么参数，以便于我们将参数填到所需的地方，这里就以这个在 WebView 中弹出原生的提示框为例！</p>
<p>如果不处理网页的 js 弹框，他是这样的：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5276837-b568062206f118dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="DiaLog.png"></p>
<p>那么这样用户体验就不好了！凡是网页时有 js 弹框的地方，我们都可以用在 setWebChromeClient(new WebChromeClient() {} 中 重写父类的 onJsAlert() 来讲之转换为原生弹框。</p>
<p>接下来我们打一个断点来追踪一下网页需要什么参数让我们传，关于网页服务端的所有接口都是这样来看参数的，所以你看好了！</p>
<p><img src="C:\Users\MaiBenBen\Desktop\新建文件夹\funName.png" alt="funName"></p>
<p>可以看到，我在没有填密码的时候点击了修改密码，它就接着执行了这个方法，并且有一个 message 参数显示的是提示信息，那么我们直接就将这个 message 设置到我们原生弹框中所需要的消息就 OK 了！记住，后面的接口方法都是这么判断，再说一遍！</p>
<p><strong>重点来了，将设置应用到 WebView 中去。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">com.lansum.eip.webview.WebViewController</span></span></div><div class="line">        <span class="attr">android:id</span>=<span class="string">"@+id/main_webview"</span></div><div class="line">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></div><div class="line">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span> /&gt;</div></pre></td></tr></table></figure>
<p>还记得上面类第一行的包吧！没错，就是把这个类的包路径直接加载布局中，像添加自定义布局的方式一样，现在起我们的 WebView 就已经具备了代码中所有的设置！</p>
<p>关于这个类（WebViewController），也我们专门用于处理 WebView 的看，如何去搭配下一个重头戏的类（HtmlMessageForLocal 类）！作用，本地与WebView交互类，根据点击的WebView位置服务端发送相应接口，本地去实现这些接口！非常重要！</p>
<p>此次就到这里，我们下篇文章继续，揭开这个 HtmlMessageForLocal  类的真实面目，并与我们的 WebViewController 类搭配起来完成所有网页的处理，此次分享落幕！</p>
<p>微信公众号「smartbeng」,吐血版珍藏持续更新，一个会爱上的公众号。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/5276837-57fef8e088c293ff.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="webwxgetmsgimg.jpg"></p>

          <br>
<p>smartbeng</p>
<p><img src='/images/scribble3.png' alt='scribble'></p>

        </section>
      </div>
      
      <div class='block'>
  
    <a class='main' href='/'>Blog</a>
  
    <a class='main' href='/about/index.html'>About</a>
  
    <a class='main' href='mailto:smartbengs@gmail.com'>Email</a>
  
    <a class='main' href='https://github.com/smartbeng'>Github</a>
  
</div>

    </div>
    <footer>
  <span class='muted'>&copy; smartbeng. All Rights Reserved.</span><br>
  <a href='https://github.com/smartbeng/hexo-scribble' class='muted'>主题地址</a>
  <br>
  <br>
  <img src='/images/scribble2.png' alt='scribble' />
</footer>

  </body>
</html>
